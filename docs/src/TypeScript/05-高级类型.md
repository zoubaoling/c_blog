# TypeScript高级类型

## 题目
请详细解释TypeScript中的高级类型，包括联合类型、交叉类型、条件类型、映射类型等。

## 答案

### 1. 联合类型 (Union Types)

```typescript
// 基本联合类型
type StringOrNumber = string | number;
let value: StringOrNumber = "hello";
value = 42;

// 联合类型数组
type StringOrNumberArray = (string | number)[];
let arr: StringOrNumberArray = ["hello", 1, "world", 2];

// 联合类型函数
function processValue(value: string | number): string {
    if (typeof value === "string") {
        return value.toUpperCase();
    } else {
        return value.toString();
    }
}

// 字面量联合类型
type Direction = "north" | "south" | "east" | "west";
let direction: Direction = "north";

// 联合类型与null/undefined
type StringOrNull = string | null;
let name: StringOrNull = "张三";
name = null;
```

### 2. 交叉类型 (Intersection Types)

```typescript
// 基本交叉类型
interface Person {
    name: string;
    age: number;
}

interface Employee {
    id: number;
    department: string;
}

type PersonEmployee = Person & Employee;

const person: PersonEmployee = {
    name: "张三",
    age: 30,
    id: 1,
    department: "技术部"
};

// 交叉类型与联合类型
type StringOrNumber = string | number;
type NumberOrBoolean = number | boolean;
type Combined = StringOrNumber & NumberOrBoolean; // number

// 函数交叉类型
type FunctionA = (x: number) => string;
type FunctionB = (x: string) => boolean;
type CombinedFunction = FunctionA & FunctionB;
// 等价于: (x: number & string) => string & boolean
```

### 3. 条件类型 (Conditional Types)

```typescript
// 基本条件类型
type NonNullable<T> = T extends null | undefined ? never : T;
type T1 = NonNullable<string | number | null>; // string | number

// 条件类型与infer
type ReturnType<T> = T extends (...args: any[]) => infer R ? R : any;

// 条件类型链
type TypeName<T> = 
    T extends string ? "string" :
    T extends number ? "number" :
    T extends boolean ? "boolean" :
    T extends undefined ? "undefined" :
    T extends Function ? "function" :
    "object";

type T2 = TypeName<string>; // "string"
type T3 = TypeName<number>; // "number"
type T4 = TypeName<boolean>; // "boolean"

// 分布式条件类型
type ToArray<T> = T extends any ? T[] : never;
type T5 = ToArray<string | number>; // string[] | number[]
```

### 4. 映射类型 (Mapped Types)

```typescript
// 基本映射类型
type Readonly<T> = {
    readonly [P in keyof T]: T[P];
};

type Partial<T> = {
    [P in keyof T]?: T[P];
};

type Required<T> = {
    [P in keyof T]-?: T[P];
};

// 使用示例
interface User {
    name: string;
    age: number;
    email?: string;
}

type ReadonlyUser = Readonly<User>;
type PartialUser = Partial<User>;
type RequiredUser = Required<User>;

// 自定义映射类型
type Pick<T, K extends keyof T> = {
    [P in K]: T[P];
};

type Record<K extends keyof any, T> = {
    [P in K]: T;
};

// 使用示例
type UserName = Pick<User, 'name'>;
type UserMap = Record<string, User>;
```

### 5. 模板字面量类型 (Template Literal Types)

```typescript
// 基本模板字面量类型
type EmailLocaleIDs = "welcome_email" | "email_heading";
type FooterLocaleIDs = "footer_title" | "footer_sendoff";

type AllLocaleIDs = `${EmailLocaleIDs | FooterLocaleIDs}_id`;

// 字符串操作类型
type Uppercase<S extends string> = S extends string ? Uppercase<S> : never;
type Lowercase<S extends string> = S extends string ? Lowercase<S> : never;
type Capitalize<S extends string> = S extends string ? Capitalize<S> : never;
type Uncapitalize<S extends string> = S extends string ? Uncapitalize<S> : never;

// 实际应用
type EventName<T extends string> = `${Uncapitalize<T>}Changed`;
type T0 = EventName<"foo">; // "fooChanged"

// 多级模板字面量
type PropEventSource<T> = {
    on<K extends string & keyof T>(eventName: `${K}Changed`, callback: (newValue: T[K]) => void): void;
};

declare function makeWatchedObject<T>(obj: T): T & PropEventSource<T>;

const person = makeWatchedObject({
    firstName: "Saoirse",
    lastName: "Ronan",
    age: 26
});

person.on("firstNameChanged", (newName) => {
    console.log(`new name is ${newName.toUpperCase()}`);
});
```

### 6. 索引访问类型 (Index Access Types)

```typescript
// 基本索引访问
type Person = { age: number; name: string; alive: boolean };
type Age = Person["age"]; // number
type I1 = Person["age" | "name"]; // string | number
type I2 = Person[keyof Person]; // string | number | boolean

// 数组索引访问
const MyArray = [
    { name: "Alice", age: 15 },
    { name: "Bob", age: 23 },
    { name: "Eve", age: 38 },
];

type Person2 = typeof MyArray[number]; // { name: string; age: number; }
type Age2 = typeof MyArray[number]["age"]; // number
type key = "age";
type Age3 = typeof MyArray[number][key]; // number
```

### 7. 实际应用场景

```typescript
// 1. API响应类型构建
interface ApiResponse<T> {
    data: T;
    status: number;
    message: string;
}

type ApiError = {
    error: string;
    code: number;
};

type ApiResult<T> = ApiResponse<T> | ApiError;

// 2. 状态管理类型
type LoadingState = {
    state: "loading";
};

type SuccessState<T> = {
    state: "success";
    data: T;
};

type ErrorState = {
    state: "error";
    error: string;
};

type AsyncState<T> = LoadingState | SuccessState<T> | ErrorState;

// 3. 表单验证类型
type ValidationRule<T> = {
    required?: boolean;
    minLength?: number;
    maxLength?: number;
    pattern?: RegExp;
    custom?: (value: T) => boolean;
};

type FormValidation<T> = {
    [K in keyof T]: ValidationRule<T[K]>;
};

// 4. 事件系统类型
type EventMap = {
    click: { x: number; y: number };
    keypress: { key: string };
    submit: { formData: FormData };
};

type EventHandler<T> = (event: T) => void;

type EventHandlers = {
    [K in keyof EventMap]: EventHandler<EventMap[K]>;
};
```
