## Vue的虚拟DOM

### 定义
- 虚拟 DOM（Virtual DOM）是一个轻量 JS 对象，用来描述真实 DOM 的结构（`tag`、`props`、`children` 等）。
- Vue 通过 `VNode` 创建这些对象，在状态变化时用它们来决定真实 DOM 如何更新。

### 作用
- 降低直接操作 DOM 的成本：先比较新旧 VNode，再“定点 patch”真实节点。
- 渲染平台可抽象：相同的 VNode 可输出到 Web、Native、服务端渲染等环境。
- 状态驱动 UI：`render` 返回 VNode，逻辑清晰、易测试。

### 工作流程
1. **render**：响应式数据生成新的 VNode 树。
2. **diff**：与旧树对比，找出需要变动的节点。
3. **patch**：按变动类型更新真实 DOM（新增、删除、改属性、改文本）。

### diff 关键点
- 只比较同层节点，不跨层移动。
- 合理使用 `key` 帮助复用节点，避免不必要的销毁/创建。
- Vue 3 会把静态节点提升或缓存，减少 diff 工作量。

### 优势与局限
- **优势**：性能稳定、便于组件化开发、天然支持跨平台渲染。
- **局限**：初次构建和 diff 也要成本；`key` 使用不当会拖累性能；复杂动画等场景可能仍需直接操作 DOM。

### 面试速记
1. 定义 VNode 是真实 DOM 的抽象。
2. 说出三步流程：render → diff → patch。
3. 提及同层 diff、`key` 复用等实现细节。
4. 总结优缺点，说明它不是银弹。

### 常见术语
- **VNode**：虚拟节点对象。
- **Patch**：把 diff 结果同步到真实 DOM 的动作。
- **Renderer**：具体平台的渲染实现，可自定义扩展。