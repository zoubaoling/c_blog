## Vue 项目部署后刷新 404 怎么办？

### 一句话回答
History 模式下刷新或访问嵌套路由会直接向服务器请求对应路径；如果服务器只返回静态文件目录，没有兜底把所有路由重定向到 `index.html`，就会返回 404。给服务器增加“找不到时回退到 `index.html`” 的配置即可。

### 发生原因
1. 本地开发服务器（`vue-cli-service serve` / Vite）默认做了 SPA 回退逻辑，所以刷新不会报错。
2. 发布到 Nginx、Apache 或静态 CDN 后，URL `/login` 会被认为是一个真实的文件路径。
3. Nginx 默认只会根据配置找到具体文件，没找到就返回 404，不会交给前端路由继续处理。

### Nginx 正确示例（History 模式）
```nginx
server {
  listen 80;
  server_name www.xxx.com;
  root /data/dist;           # 指向打包目录
  index index.html;

  location / {
    try_files $uri $uri/ /index.html;  # 重写到入口文件
  }
}
```
- `try_files $uri $uri/ /index.html;` 的含义：先查找真实文件；没有就回退到 `index.html`，由前端路由接管。
- 确保 `root`、`index` 配置正确，避免 500 循环跳转。

### 其它服务器/平台
- **Apache**：在根目录加 `.htaccess`
  ```
  <IfModule mod_rewrite.c>
    RewriteEngine On
    RewriteBase /
    RewriteRule ^index\.html$ - [L]
    RewriteCond %{REQUEST_FILENAME} !-f
    RewriteCond %{REQUEST_FILENAME} !-d
    RewriteRule . /index.html [L]
  </IfModule>
  ```
- **Node/Express**：
  ```js
  app.use(express.static('dist'))
  app.get('*', (_, res) => res.sendFile(path.resolve(__dirname, 'dist/index.html')))
  ```
- **静态托管（Netlify/Vercel/S3+CloudFront）**：配置“SPA fallback”或自定义重写规则指向 `index.html`。

### hash 模式为什么不会 404？
- URL 格式：`www.xxx.com/#/login`。`#` 号之后的内容不会被浏览器发送到服务器，只在前端解析。
- 缺点：URL 不够美观，SEO 支持差；优点是无需服务器配置，适合静态托管的快捷方案。

### 面试答题提纲
1. 说明问题：History 模式刷新/直达路由 404。
2. 分析原因：服务器没有配置 SPA fallback。
3. 给出 Nginx/其他服务器的配置示例。
4. 补充 hash 模式优缺点，突出对路由模式的理解。
5. 提醒部署时要配合缓存、gzip、HTTPS 等优化（可视时间简单提及）。

### 参考资料
- [Vue 官网部署指南](https://cn.vuejs.org/guide/scaling-up/deployment.html)
- [Vue3 面试题解析 - 404](https://vue3js.cn/interview/vue/404.html)
