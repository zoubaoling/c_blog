## vite的原理
**开发环境**
- 直接启动开发服务器，不需要进行打包操作，也就不需要分析模块的依赖、不需要编译，因此启动速度非常快
- 真正的按需编译：利用现代浏览器支持ES Module的特性，当浏览器请求(import)某个模块的时候，再根据需要对模块的内容进行编译，大大缩短了编译时间
- Vite中HMR是在原生ESM上执行的。当编辑一个文件时，仅需编译该模块并让浏览器重新请求该模块即可，无须像webpack那样需要把该模块的相关依赖模块全部编译并打包一次，效率更高
- 使用esbuild处理项目依赖，esbuild使用go编写，比一般node.js编写的编译器快几个数量级
  
**生产环境**
- 集成Rollup打包生产环境代码，依赖其成熟稳定的生态与更简洁的插件机制

### 原理
1. `ESbuild编译`，esbuild使用go编写，cpu密集下更具性能优势，编译速度更快
2. `依赖预构建`
     - 模块化兼容：Vite在预构建阶段将依赖中各种其他模块化规范(CommonJS、UMD)转换成ESM，以提供给浏览器
     - 性能优化：npm包中大量的ESM代码，大量的import请求，会造成网络拥塞。Vite使用esbuild，将有大量内部模块的ESM关系转换成单个模块，以减少import模块请求次数。
3. `按需加载`: 只在接受到import请求的时候，才会编译对应的文件，将ESM源码返回给浏览器，实现真正的按需加载
4. `缓存`
     - HTTP缓存：充分利用http缓存做优化，依赖（不会变动的代码）部分用max-age,immutable 强缓存，源码部分用304协商缓存，提升页面打开速度。
     - 文件系统缓存：Vite在预构建阶段，将构建后的依赖缓存到node_modules/.vite ，相关配置更改时，或手动控制时才会重新构建，以提升预构建速度

### 优点
  - 快！快！非常快！！
  - 高度集成，开箱即用
  - 基于ESM急速热更新，无需打包编译
  - 基于`esbuild`的依赖预处理，比Webpack的`node编写的编译器快`几个数量级
  - 不与Vue绑定，支持React等其他框架，独立的构建工具。
  - 兼容Rollup庞大的插件机制，插件开发更简洁。
  - 天然支持TS
  - 内置SSR支持
  
### 不足
  - Vue仍为第一优先支持，量身定做的编译插件，对React的支持不如Vue强大
  - 生产环境集成Rollup打包，与开发环境最(esbuild)终执行的代码不一致

**VS Webpack**
- Webpack通过先将整个应用打包，再将打包后代码提供给dev server，开发者才能开始开发
- Vite直接启动开发服务器，不需要进行打包操作，也就不需要分析模块的依赖、不需要编译，因此启动速度非常快, 利用现代浏览器支持ES Module的特性，当浏览器请求某个模块的时候，再根据需要对模块的内容进行编译，大大缩短了编译时间,真正的按需编译

### vite的构建流程
1. 启动开发服务器：通过运行 vite 命令，Vite启动一个开发服务器，基于原生ESM，不进行打包操作
2. 当浏览器初始请求时，Vite分析入口文件，解析任何存在的 import语句，递归地查找和加载所有依赖的模块
3. Vite会检查模块是否已经被编译，如果没有，根据模块的类型（.js、.vue）采取不同的编译策略实时编译每个模块，真正的按需编译
     - JS/TS文件，Vite使用esbuild进行快速的原生ES模块转换，生成浏览器可直接执行的代码
     - Vue单文件组件（.vue 文件），Vite使用 @vue/compiler-sfc解析并编译它们成为JS代码
4. 完成编译后，Vite 会将模块包裹在一个虚拟模块中，并将模块作为一个请求的响应返回给浏览器。这样浏览器可以直接加载这些虚拟模块，无需打包成独立文件
5. 文件内容修改时，支持热模块替换（HMR），不需要加载整个页面
     - vite开发服务器监听到变化重新编译改动文件
     - websocket推送消息到浏览器，告知哪些模块需要更新
     - 浏览器收到更新通知，会请求更新的模块文件，替换旧的模块

webpack会从入口文件开始，分析构建整个应用的依赖树，递归解析所有依赖的模块；

vite从浏览器请求入口开始，按照import递归查找和加载所有依赖的模块，只加载当前活动页面的所有依赖，而不是整个应用


### HMR应用区别
1. webpack默认不开启,devServer.hot: true；vite默认开启;vue-cli默认开启
2. webpack默认支持:js css;vite默认支持: js css vue; vue-cli: js css vue
3. 额外配置
  - webpack: vue(vue-loader),react(react-hot-loader); 图片和其他资源
  - vite/vue-cli: 全局css，某些第三方库