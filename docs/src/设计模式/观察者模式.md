# 观察者模式 VS 发布订阅模式
都是用于解决观察者和主题对象之间的耦合性，发布订阅模式有一个中介来处理事件发布订阅，发布者和消息者互不了解

## 观察者模式
定义了一种一对一或者一对多的关系，多个观察者同时监听某一个主体对象。主体对象发生变化时，遍历通知其所有的观察者对象，是他们能够自动更新
### 组成部分
1. `主体Subject` 被观察的对象，可以添加、移除、通知观察者
2. `观察者Observer` 在主体对象发生变化时，实现一个更新接口接受通知并进行更新

### 原理
1. 主体维护：观察者列表、添加观察者、删除观察者、通知观察者(执行观察者的update)
2. 观察者维护：update更新方法，当主体通知时执行执行
3. 一或多个观察者注册到主体中，通过调用主体的添加观察者方法实现
4. 观察者的更新逻辑内部自身维护

## 发布订阅模式
是一种消息传递模式，`发布者`不会直接将消息发送给`订阅者`，而是通过`消息代理/事件总线`来完成, 发布者将消息发送到消息代理，订阅者通过消息代理订阅消息
### 组成部分
1. `发布者Publisher` 发布消息的对象
2. `订阅者Subscriber` 订阅消息的对象
3. `消息代理Event Bus` 消息的中介，负责事件和相应的处理程序
   
#### 原理
1. 消息代理维护：事件池、订阅事件、取消订阅事件、触发事件
2. 发布者可以继承消息代理或者绑定上下文，来执行触发事件进而发布消息
3. 订阅者可以继承消息代理或者绑定上下文，来执行订阅事件

## 区别
1. `维护位置` 观察者模式将观察者列表直接维护在主体对象上，发布订阅模式将事件池维护在消息总线中
2. `依赖关系` 观察者模式需要观察者和主体对象协商一个update方法，主体对象变化通知时，执行约定好的观察者的update方法; 而发布订阅模式是将事件列表注册到消息代理的事件池中，发布消息时直接执行事件池中的事件，更加灵活
3. `耦合度` 观察者模式明确观察者和主体对象之间的依赖关系; 发布订阅模式通过消息总线代理，发布者和订阅者互不了解
4. `订阅方式` 观察者模式是直接通过观察者本身直接订阅; 发布订阅模式是通过消息总线分类事件，订阅者根据不同类型的事件来订阅
5. 观察者模式大多数是同步的，比如事件触发时，主体会立刻调用观察者的方法; 发布订阅模式大多数是异步的，使用消息队列

## 场景
1. **观察者模式**适用于需要直接绑定和更新的场景，比如GUI组件的事件处理、vue的数据绑定(数据模型通知绑定的视图更新)等，主要是直接的依赖关系和自动更新
2. **发布订阅模式**适用于需要接偶的异步事件处理场景，比如消息队列、异步编程等，通过中介来解耦发布者和订阅者，提供更灵活的事件管理

## 实践代码
::: details 展开代码
::: code-group
<<< @/设计模式/observe.js [观察者模式]

<<< @/设计模式/eventBus.js [发布订阅模式]
:::