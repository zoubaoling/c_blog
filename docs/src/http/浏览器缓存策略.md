## 浏览器缓存策略（面试速记版）

### 缓存类型
- **强缓存（本地缓存）**：响应头 `Cache-Control/Expires` 控制；命中后不发请求，直接读缓存。
- **协商缓存（弱缓存）**：响应头 `Last-Modified/ETag` 控制；带条件请求询问是否更新，命中返回 304。
- **Service Worker**：脚本拦截网络请求，自定义缓存策略，可做离线。
- **Web Storage**：`localStorage/sessionStorage` 存储业务数据，不参与 HTTP 缓存协商。

### 请求流程记忆 (第二次请求开始)
1. 浏览器检查强缓存：`Cache-Control/Expires` 是否命中 → 命中(未命中)直接读缓存。
2. 未命中则发起网络请求，附带协商字段,触发协商缓存
3. 服务器判断：
   - 没有变化 → 返回 `304 Not Modified`，沿用本地文件。
   - 有变化 → 返回200 + 最新内容，并更新响应头`Last-Modified/ETag`

### 缓存的好处
- 减少重复请求，节省带宽。
- 减轻服务器压力，提升后端吞吐。
- 加速页面加载，改善用户体验。


### 强缓存细节
- `Expires`（HTTP/1.0）：绝对失效时间，受客户端时钟影响。告诉浏览器多久以内可直接使用缓存
- `Cache-Control`（HTTP/1.1）优先级更高：
  - `max-age=3600`：相对失效时间。
  - `no-cache`：不直接用强缓存，需要协商缓存。
  - `no-store`：完全不缓存（登录信息、支付页等）。
  - `public/private`：是否允许代理缓存。

### 协商缓存细节
- `Last-Modified` + `If-Modified-Since`（时间戳比较，秒级精度）。
  - 都是时间字符串, Last-Modified标记文件最后修改时间，下次请求会将此值带入IF-Modified-Since,服务器根据时间来比对
   - 没有变更返回304，不返回资源内容；有变更返回资源内容，更新Last-Modified
- `ETag` + `If-None-Match`（内容指纹，推荐搭配使用）。
    - 是服务器给每个资源生成的唯一标识串，资源变化值就会变化
   - ETag的值在下次请求时会代入IF-None-Match,服务器比对，即时304，也会将ETag返回

> **ETag 优于 Last-Modified 的典型原因**：文件秒级内频繁修改、时间不准确、某些环境无法获取准确修改时间。

##### ETag 替换 Last-Modified的原因
1. 文件修改时间变了，但是内容可能没变，不希望客户端认为资源修改了
2. 文件修改比较频繁可能在秒以内，但是Last-Modified只能精确到秒
3. 某些服务器不能精确得到文件最后的修改时间

### 优先级与判定顺序
`Service Worker` > `强缓存` > `协商缓存` > `Web Storage`

### 面试速答套路
1. 先列出两类核心缓存（强 vs 协商），简单定义。
2. 描述判定流程（强缓存命中 → 协商缓存 → 更新）。
3. 提及关键响应头（`Cache-Control/ETag`）及常见取舍。
4. 补充 Service Worker、Web Storage 的位置层级与使用场景。