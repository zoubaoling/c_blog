## 怎么实现图片懒加载
> 懒加载是图片进入可视区域才加载，全部加载的话影响性能体验

**基础要素：**
- 可视区高度：window.innerHeight || document.documentElement.clientHeight || document.body.clientHeight
- `getBoundingClientRect`获取元素相对浏览器的位置: x/left y/top bottom right
  - x/left: 内容左侧到视口左侧的距离
  - right: 内容右侧到视口左侧的距离
  - y/top: 内容顶部到视口顶部的距离
  - bottom: 内容底部到视口顶部的距离

**实现方法：**
- 标签加上 loading=lazy，一些旧的浏览器不支持
- js基于事件监听（传统）: 
  - img标签最开始添加属性data-src=url，src=''
  - 通过属性data-src拿到所有图片及其URL信息
  - 遍历图片，判断图片是否在可视区域内: getBoundingClientRect.bottom>0|top<可视区域高度 （或img.offsetTop < window.innerHeight + window.scrollY）
  - 在可视区域内，src属性赋值url, 移出标签属性data-src
  - 监听scroll事件，可以节流处理，比如每200ms一次
  - 手动管理事件监听和元素检查，以及滚动时大量计算，可能导致滚动性能问题
- **IntersectionObserver** 交叉元素是否可见，目标元素与可视区产生一个交叉区。当被监听元素进入设定区域，自动触发回调函数
  - const observer = new IntersectionObserver((entries, observer)),创建监听器，回调函数第一个参数是观察的元素列表，第二个参数是监听器，可用于移除某个元素的监听
  - 回调处理：遍历entries所有监听的元素/图片，isIntersection为true就是在可视区域，同上修改src 和 data-srcs属性;obeserver.unobserve()解除该图片的监听
  - 通过data-src遍历所有img元素，使用observer.observe监听每个图片元素
  - 老版本可能不支持