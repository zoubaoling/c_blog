## Javascript本地存储的方式有哪些？区别及应用场景
> 常见方案：Cookie / localStorage / sessionStorage / IndexedDB

### 快速对比
| 特性 | Cookie | localStorage | sessionStorage | IndexedDB |
| --- | --- | --- | --- | --- |
| 存储上限 | ≈4 KB | ≈5 MB | ≈5 MB | 理论无限 |
| 生命周期 | 受 `expires`/`max-age` 控制 | 永久，需手动清除 | 页面/标签关闭即清除 | 开发者控制 |
| 作用域 | 同域、可配置子域和路径 | 同源 | 同源、单标签页 | 同源 |
| 传输 | 每次 HTTP 请求自动携带 | 仅本地 | 仅本地 | 仅本地 |
| 数据结构 | 字符串 | 字符串 | 字符串 | 键值、复杂对象 |
| API 难度 | 需要自己解析 | 简单同步 API | 简单同步 API | 异步、类似数据库 |

---

### Cookie
- 诞生于解决 HTTP 无状态的问题，兼容性最好。
- 必要属性：`name=value; expires; max-age; domain; path; secure; HttpOnly; SameSite`。
- 常见问题：容量小、自动随请求发送导致带宽浪费，需要封装读取。
- 典型场景：会话标识、A/B 测试打点、与服务端协同的状态。
- 读取/设置：
  ```js
  document.cookie = "token=abc; max-age=3600; path=/";
  ```

### localStorage
- HTML5 引入的键值对存储，IE8+ 支持。
- 特点：同源共享、持久化，浏览器关闭不清空。
- 限制：只能存字符串，可序列化对象；无过期策略；隐私模式不可用。
- 常见场景：长期保存的偏好设置、无敏感性的令牌、缓存轻量静态数据。
- 样例：
  ```js
  localStorage.setItem("theme", "dark");
  const theme = localStorage.getItem("theme");
  ```

### sessionStorage
- API 与 localStorage 相同，但生命周期绑定当前标签页。
- 不与其他标签页共享，标签页刷新保留，关闭即清除。
- 适合场景：一次性验证码、表单临时草稿、敏感会话透传。

### IndexedDB
- 浏览器内置的 NoSQL 数据库，支持对象存储、索引和事务。
- 特点：容量大、异步 API、可存复杂结构。
- 常见场景：离线应用、富文本草稿、批量数据缓存、渐进式 Web 应用。
- 访问示例：
  ```js
  const request = indexedDB.open("demo", 1);
  request.onupgradeneeded = () => request.result.createObjectStore("users", { keyPath: "id" });
  ```

---

### 常见面试问法与记忆点
- **容量 + 生命周期**：Cookie 4 KB + 受 max-age/expires；Storage 5 MB 左右；IndexedDB 理论无限。
- **是否随请求发送**：只有 Cookie，注意带宽和 CSRF 风险。
- **读写方式**：Storage 为同步 API，IndexedDB 为事件驱动的异步 API。
- **安全与策略**：`HttpOnly`/`SameSite` 针对 Cookie；Storage 遵循同源；IndexedDB 同源但可建多表。
- **选型口诀**：会话协商用 Cookie；长期偏好用 localStorage；临时敏感信息用 sessionStorage；离线大数据用 IndexedDB。
